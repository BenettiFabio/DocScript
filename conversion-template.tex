%------------------------------------------------------------------------------
% Document class configuration
%------------------------------------------------------------------------------
\documentclass[11pt,a4paper]{report}
%\documentclass[11pt,a4paper]{article}

%------------------------------------------------------------------------------
% Company Command Definitions
%------------------------------------------------------------------------------
\newcommand{\mrplabel}[1]{\phantomsection\label{#1}}

\newcommand{\colorbitbox}[3]{%
\rlap{\bitbox{#2}{\color{#1}\rule{\width}{\height}}}%
\bitbox{#2}{#3}}

\newcommand{\bitlabel}[2]{%
\bitbox[]{#1}{%
\raisebox{0pt}[4ex][0pt]{%
\turnbox{45}{\fontsize{8}{8}\selectfont#2}%
}%
}%
}

\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{naturalnames}{hyperref}
%------------------------------------------------------------------------------

\usepackage{xcolor}     % Pacchetto per i colori
\usepackage{color}      % per Shaded
\usepackage{tcolorbox}  % per le evidenziature
\usepackage{hyperref}   % Per i link
\usepackage[hypcap]{caption}
\usepackage{framed}     % per i blocchi di codice
\usepackage{url}        % per mandare a capo url molto lunghi
\usepackage{listings}   % per lo stile di indentazione
\usepackage{enumitem}   % per gli indici

\usepackage{graphicx}   % per immagini
\usepackage{float}
\usepackage{caption}

\usepackage{longtable}  % per le tabelle
\usepackage{booktabs}
\usepackage{array}
\usepackage{calc}

\usepackage{amssymb} % per i simboli matematici
\usepackage{amsmath} % per le formule matematiche

\usepackage{multicol}   % per il toc a due colonne
\usepackage{tocloft}    % per il numero di pagina sul toc

\usepackage{bookmark}

\usepackage{fontspec}   % per i box-drawing
\setmainfont{FreeSans}
\setmonofont{FreeMono}

\usepackage{tikz}       % per gli schemi con Tikz
\usetikzlibrary{shapes.geometric, arrows.meta, positioning}
\usetikzlibrary{arrows.meta, positioning, shapes.geometric, shadows, calc, backgrounds}

\usepackage{pdfpages}    % per le pagine in PDF

\usepackage{fancyhdr}   % per gli header/footer
\usepackage{lastpage}

$if(draft)$
\usepackage{draftwatermark} % watermark
$endif$

% Imposta le dimensioni della pagina
% \usepackage[a4paper, margin=0.7in]{geometry}
\usepackage[a4paper, margin=0.7in, includefoot, bottom=1in]{geometry}

% Definisci i colori scritte personalizzati
\definecolor{darkviolet}{rgb}{0.58, 0.0, 1.0}
\definecolor{red}{rgb}{1.0, 0.0, 0.0}
\definecolor{orange}{rgb}{1.0, 0.647, 0.0}
\definecolor{skyblue}{rgb}{0.53, 0.81, 0.98}
\definecolor{brown}{rgb}{0.65, 0.16, 0.16}
\definecolor{green}{rgb}{0.0, 0.5, 0.0}

% Definisce i colori per gli evidenziatori
\definecolor{hlyellow}{RGB}{255, 249, 196}      % Giallo pastello
\definecolor{hlred}{RGB}{255, 205, 210}         % Rosso chiaro/pesca
\definecolor{hlgreen}{RGB}{200, 230, 201}       % Verde menta chiaro
\definecolor{hlviolet}{RGB}{232, 215, 255}     % Viola chiaro/lilla
\definecolor{hlorange}{RGB}{255, 224, 178}      % Arancione tenue
\definecolor{hlskyblue}{RGB}{187, 222, 251}      % Azzurro pastello


% indentazione dei blocchi di codice con lo stile tango
\definecolor{TangoRed}{RGB}{204,0,0}
\definecolor{TangoGreen}{RGB}{78,154,6}
\definecolor{TangoBlue}{RGB}{52,101,164}
\definecolor{TangoGray}{RGB}{238,238,236}

\lstdefinestyle{tango}{
    % backgroundcolor=\color{TangoGray},
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{TangoBlue}\bfseries,
    commentstyle=\color{TangoGreen}\itshape,
    stringstyle=\color{TangoRed},
    breaklines=true,
    showstringspaces=false,
    numberstyle=\tiny\color{gray},
    numbers=left,
    numbersep=5pt,
}

% personalizzazione dei blocchi di codice
\lstset{
    basicstyle=\small\ttfamily,     % riduce la dimensione
    breaklines=true,                % fa andare a capo
    breakatwhitespace=false,        % fa andare a capo solo negli spazi bianchi
    columns=flexible,               % evita tagli strani a metà carattere
    linewidth=\linewidth,           % obbliga a stare dentro un certo margine
    keepspaces=true,
    extendedchars=true,
    frame=single,
    showstringspaces=false,
    numbers=left,          % mostra i numeri di riga a sinistra
    numberstyle=\tiny,     % stile dei numeri (puoi personalizzarlo)
    numbersep=5pt,          % distanza tra i numeri e il codice
    xleftmargin=\parindent,
    xrightmargin=\parindent,
    style=tango
}

% Comportamento generale testo
\sloppy % Permette di andare a capo se la parola è troppo lunga

% nella conversione possono esserci dei \passthrough che dicono a latex di non fare semplicemente niente
\newcommand{\passthrough}[1]{#1}

\providecommand{\pandocbounded}[2]{#2}

% Definizione fallback per \tightlist
\providecommand{\tightlist}{%
    \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

$if(highlighting-macros)$
$highlighting-macros$
$endif$

%------------------------------------------------------------------------------
% Header and footer setup
%------------------------------------------------------------------------------
% Redefine the title page style
$if(headerfooter)$
\fancypagestyle{firststyle}
{
    \fancyhf{}
    \renewcommand{\headrulewidth}{0pt} % Line at the header invisible
    \renewcommand{\footrulewidth}{0pt} % Line at the footer invisible
    \fancyfoot[C]{$footerText$}
    \fancyfoot[R]{\footnotesize \thepage\ / \pageref{LastPage}}
}

% Redefine the plain page style => like the chapters
\fancypagestyle{plain}{%
    \fancyhf{}
    \fancyfoot[R]{\thepage\ / \pageref{LastPage}}%
    \renewcommand{\headrulewidth}{0pt} % Line at the header invisible
    \renewcommand{\footrulewidth}{0.4pt} % Line at the footer visible
}

% Redefine the normal page style
% \fancypagestyle{normal}
\fancypagestyle{fancy}
{
    \fancyhf{}
    \renewcommand{\headrulewidth}{1pt} % Line at the header visible
    \renewcommand{\footrulewidth}{1pt} % Line at the footer visible

    \fancyhead[L]{\includegraphics[height=40pt]{$LogoFileName$}}
    \fancyhead[R]{$CompanyDepartment$ \\\ TECHNICAL DESCRIPTION \\\ $CompanyDocumentCode$}
    
    \fancyfoot[C]{$footerText$}
    \fancyfoot[R]{\thepage / \pageref{LastPage}}
}

\setlength{\headheight}{50pt}
\setlength{\headsep}{10pt}
\setlength{\footskip}{30pt}
\makeatletter
\let\ps@plain\ps@fancy
\makeatother
$endif$
%------------------------------------------------------------------------------

%------------------------------------------------------------------------------
% Graphics ext+path declaration
%------------------------------------------------------------------------------
\graphicspath{{assets/}{../assets/}}

%\overfullrule=2cm %useful to debug box overfull!

\DeclareGraphicsExtensions{.pdf,.png,.jpg}
%------------------------------------------------------------------------------

\begin{document}
% Set the page style to "fancy"
\pagestyle{fancy}
\fancypagestyle{firststyle}

$if(titlepage)$
\begin{titlepage}

$if(draft)$
\DraftwatermarkOptions{stamp=false}
$endif$

\title{%
\includegraphics[width=0.5\textwidth]{$LogoFileName$} 
\\[1cm]
$CompanyProject$ 
\\
$CompanyStudyTitle$
}
\author{$CompanyDesigner$}
\date{\today}

\maketitle % Insert the title, author and date
\thispagestyle{firststyle}
\pagestyle{fancy}
\end{titlepage}
$endif$

$if(draft)$
\SetWatermarkText{\texttt{$watermark_text$}}
\SetWatermarkAngle{45}
\SetWatermarkScale{1.0}
\SetWatermarkFontSize{3cm}
\SetWatermarkHorCenter{10cm}
\SetWatermarkVerCenter{10cm}
\DraftwatermarkOptions{%
	color={[RGB]{255,191,191}}
}
$endif$


$if(toc)$
%------------------------------------------------------------------------------
% Table of Contents
%------------------------------------------------------------------------------
\cleardoublepage
\setcounter{secnumdepth}{$tocDepth$}
\setcounter{tocdepth}{$tocDepth$}
\tableofcontents
\cleardoublepage
$endif$

$if(draft)$
\DraftwatermarkOptions{stamp=true}
$endif$

%------------------------------------------------------------------------------
% Document body content
%------------------------------------------------------------------------------
\pagestyle{fancy}

$body$

\pagestyle{fancy}


%------------------------------------------------------------------------------
% End of document content
%------------------------------------------------------------------------------
$if(listtables)$
\cleardoublepage
% \phantomsection
\addcontentsline{toc}{chapter}{\listtablename}
\listoftables
$endif$

$if(listfigures)$
\cleardoublepage
% \phantomsection
\addcontentsline{toc}{chapter}{\listfigurename}
\listoffigures
$endif$

%------------------------------------------------------------------------------
% Last page
%------------------------------------------------------------------------------
\newpage
\cleardoublepage

\newpage
\thispagestyle{empty}
$if(draft)$
\DraftwatermarkOptions{stamp=false}
$endif$
\vspace*{\fill}
\noindent
\hspace*{-\oddsidemargin}%
\begin{center}
This page has been intentionally left blank.
\end{center}
\vspace*{\fill}
\newpage
\cleardoublepage
\end{document}
